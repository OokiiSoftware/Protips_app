workflows:
  my-workflow:
    name: ProTips
    environment:
      vars:
        XCODE_WORKSPACE: "swiftly.xcworkspace"
        XCODE_SCHEME: "swiftly"
        BUNDLE_ID: "com.ookiisoftware.protips"
        APP_STORE_CONNECT_ISSUER_ID: Encrypted(Z0FBQUFBQmdRU2M5VXFqY1gtOUVJVXl6TkxnaHJ4MlB2MzBBa2Y2aDl3YWQ4azVHbk1kUVZYazZxT2N1MUFYZnpmWHBqbXI2ZmdwU04xRjRrVnFuME5zdTQtckZoelc4ekQ4NkctOThrcngzbk4tMkZ3SnhORmViZWlJWFNxQWh3bEFKSzJYdVNjMFk=)
        APP_STORE_CONNECT_KEY_IDENTIFIER: Encrypted(Z0FBQUFBQmdRU2VBV3JYNFNFUnY0WlVKZTlWNnJpMUlUaVRnVGpfbFJwQ1JDUGpid2VHbkRlaFZtRGVnR3FObEtDbmpfZFp5eHRpWHR0RmdaTTRZY295alhsdE9wZUlfQ1E9PQ==)
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmdRU2YtdHc0cDBwZjdrZWdXa1lTcVViMFFTdDlTckwySkxzblpfb2NXLUdqRzdjUGdtS3FXLWRPSENiZjRmZmdqS0g2M2VERWc5T045UnVBcWY5ODFieFcwOFVMVU1RM1Q4S3RGb1h4N0NrenJmbWRQSWhla1hDTVNBeTRqM1p0QXVXcHZ1dzljaGd3amNiemUwbnBRVFhjUk5qRkZ6Z0NObGhmTlVCTkc1YlMwSGg4YjBrcGZmR01Ub2ZLcEIyQ1llMzFyUTFwdmNtTERmU09RV0tpeTBjN3hxeVpYdzgzSlhwRW5qZGRKYlg4aGxsM0oxaVBsTzdhMUh2S3NjX0lGZWxNeVF5Q0RaQ0hodmZZWTZyYXgyYTRlT2ZVSGVJMDRvNExnOU5MRjhmdVhVc0JjTE5Rb3ZOMmx0YzFxLWxXcnFsVnJ5UDhzc0lkU0dzbzZPa3hYdlBCVHgtZzNIRGRtMlRQa3A5VWNLWkVfNG13MUtrMV9GYXRzMmdqRjNLcWliODNPSW9mVHVydGtMM3ZxYVp1OWx5MzZWUVU1OU5SaHd3MkFadmdZWGtrSWt4VT0=)
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmdRU3FLekpsT1lBOTZMZ216WGRWMVR4c3RuY0hhOVFZRjBCLU5kbnZCVGhXeV9IejU2akwzdEh5ejBqLWNzZkZ0Qm1TYmV2ME94N25lSlkzV1NCRThQZTVkU3RORHVkN21BZ1JFVmxTaC02VlFzMmhEeklQWEtZZmp0dkNFd1dJT1lTdVpoRU1vMVFXdWxqQkc0OVB1aFc4VTVYbWhxVldweXRKNGVvdkZlX1EtRk1nbktRVmM1LU5WdXBWcWM0ZHI4cV9rakRoUjF0bHFfSlBaSUJUWEE0eW5nV3had09PQ1J6S3RpY19GUlFpbXBpcnM4U1dNMV8yM0p0b213b0RUN3BiNGZ5QVI4aGFXSTNZa1NxUU54STdIS0hRdWNkUGdBNlAwQTAxQ1JjanNnT2FjM3pFdDVTUXJlMWVtamY5LUxpaWdIeHdNOHBnSk81eG81WWVHUTlQSlQ3Rm9RLVRFNXFReDNZcnNROG5XczVSMFdCeHY2anVYZWdFSVV4NmJiWXVEb0h6eWtVaW1vcWlXWURJSFQzVnZkVWd2bFlLU0hiTUtJcFoyVkpMNWJsOC1KQTNuM0FTS0xtd2Y0SkR0WlN4d015N25FQTdpY1F5ZU4wazV6VXhxTlhBb09RUlFRVTdHUHlIVnY0TUVBWG9TWkVTbE5ISzR4XzJKbDhQSHRRbkZpWC1jcFlEYlFjUTcyRFRSQTVaR2gxdXBnV3M1empEbjJ5Q0pEVjVDTjJTVHA5cG8wRWNJUzgyR1UybkZ0bkp4TUNpcTN1TWNzbmY4NUg1TGxBZFZ3dkZ0QmlwSzNBUHJESmNNelItZ19zR08xWVRpNkM3TjFmTHI3WU1TQ0JzX3ZuaDNXbDU2b2ZRcUlqQUtsWTFIRVEwMllsS3JLa1hSQ1A4cTg3QjVQdnFnSXN1UWxsYndwVFFvR21MU21mYktoeEluelAyeVkxbHlNQTVLV1F0SUl6MlRVdnZpQ0VKa1IxLXdXSDUyTzlvQ3NRN3kyTEJSM0VhNThUU1pYMHJDbWdkakVXSTF4aldnb0NsV3NvaFJxMXloLWpab3kyVVZjWk1mRTZNckRtUnFTY1hKRkVyY0ROSDF2X1lnN05vM0RzYmtYWERvZ3pxSFA4TXpoTlA1VDBVUVJrSjZQRFMya1RzQzRYMjc2WEc2QnhCckx2U0ppenVLY0Utc1p4NXIzSjJJa3Q2WGtzZmhLbzR1eF80SGdWZkZDOU4yZ3kxRHk3aEpXN0g5N0ZtMlpBRXh6SzVQNEJhNmY0N3FMNEppOHlrQmhBSzUxR0dfNVFvcTVNYUhVUzdaS3dJY0NVUDlzdXRIZ2RTeUZ1MjN3YVpyRllwbXVxb3lPVkExeG9ELTF1ZFhlckFUWnBlUHFrRnVnLXlWbUZEWW1zM1JKVG85Wm03dE92Q3VDY0NCZmdmY3BFeTRpLUVOVmo1WDVzbXNhRWNKazE0bUpOWWF2LWJCZFJsSTd2OGZkcXdHNE9JaklRSG9lN3ZfOHQwamRGTjk5NUFWVTYxam95M0VYUl8zN0dxd1B6NjNRbW14T05QNzZ3S1BqNW1RTXpMWkN0VzA3clZreHRkLXIzTURETnhEZHp6enNZeENNMEtiekU4TDRzV1ZRWnJaNVdjRUkxTGdqaENEenByNGtrMENUMnZsLVBYdVRWcXZOcEdsZnV6cjFWY2NPZ0N4LUNFQmw0REsxR0JfVmJOQXNiY1l4akhDSEFWRFA1SDExa2laeDh1a21FMzE3eWk0R3U4aW1ha0lDOVlQWlY2WGNMamRRbktVUjVpQnBQSnhrSjd1dEhHSHV3THR1QXdIeFJjX3FjZFlCSTZDYXFIU0lXdkQzWDJaNkl6MjRqUWpyakxxRWpGbnhNUjlWTDFWQVVUSjBJQ0g5eXdZM2p4VlVuZEN3VkZSS1FBQ0ZrcllKaURpNi1WLWExY25EYklMaUVlRXFMOTZsRnBSWVlCZk9YeHdTa2N4dHBFTm5felpiSzY2RlJ0cVR4TWM4TFZlU1N1QmUtdnJUS0RhdjdjT2ZvaFUwZlBWM3hwcDllT2VQM3lKOG1zaE1MUTY4Njc3NHVmdklDempqYXY2MGFma0NkOVFMOElJci1PY1FkMWJQQ2c3YVpCeFY5LTZjRk1Yc2pSZWdsVXdGSlZ5RmFublRfYU1zczhpN0REZHZqd1h0ZG5DUVNhU2RCTTBrRzRxLU9yUEpNcEQ3RVJ0alVxRE5VcG9ZNDVLRFh0ZV9WTFlnYXh3YlFBeUNTWXY0aHhoQXJBSGk2WWVzTERXZ2kxbkIxQXJNd21vUy1ydWU5NFpLck9RLXBVOFFFQ25wUVduY2VXd1RxYzltakFmWVVMZnBBUzJFQ0l0SDFDTmY3UGgxQmhQUjdXTjZpSHkxOGRPRExkVTBVNVgzazRYN2F3VXRrTkZjTEZDWnJYc2dZUDJuRnhfeHoyMFBfRHhIblNEM3ZLNGVUWTZQeHd5UUwzb1ZjN0JHdFlWOGlYc05ZNThmcWZnZW8tc2xtNUhnenFydVM4X1p2ODNETS1GYUwzNDRQU2dVcFhWRVJKdW5yaHZHNVBTaUVIUzJCOTc1Vmg4cWdrRTh4S1cxanJjVkdfeHFaV3hKMHNjUmlKLXY2VmtjeWhYcUc3cFpJTHJjZXhxeHpVdEcwOEJ3Nkl2WG1uWFNRRnRWNG9JSDB5RzJyX2M2cG5JRE5XUjZSQ1lIUnlOR2hSS2F4QnhqNk9md1N4VXBULUY5RUFkREpHMmp6ckhERmtTbG9XSU1WaFo0dkZXTTJMM2k5akVYZWVhcjhuTktkNEVac2xCTk1ESmVFejc1UzRfMnFXR2V0MC1YTXZ3VXN3ZnBsdzV4NXpLTEczMmJDUXNlWF83SHZLTGtCdDZhR2UxVTJ3RjhsYnBFTEFfalpfVGZZXzhWT1REUU16YklWRzIxTS1LM1RCaUhVN1RoQm8tOXJ1ZUxkOWVTZUttcGNMdkttSUFrTFhCQlgwS1d5Skg5U0ZxQXAxRGxRLVp0VzhsTXVMOFFqRnk4eXBqVG9UYk1uNDE5S2dCSnZ3X2d6ZHJJdXlh)
      flutter: stable
      xcode: latest
      cocoapods: default
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: 'master'
          include: true
          source: true
      cancel_previous_builds: false
    scripts:
      - name: Set up keychain to be used for codesigning using Codemagic CLI 'keychain' command
        script: |
          keychain initialize
      - name: Fetch signing files
        script: |
          app-store-connect fetch-signing-files $BUNDLE_ID --type IOS_APP_STORE --create
      - name: Use system default keychain
          script: |
            keychain add-certificates
      - name: Set up code signing settings on Xcode project
          script: |
            xcode-project use-profiles
      - name: Increment build number
          script: |
            #!/bin/sh
            set -e
            set -x
            cd $FCI_BUILD_DIR
            agvtool new-version -all $(($BUILD_NUMBER + 1))
      - name: Build ipa for distribution
          script: |
            xcode-project build-ipa --workspace "$XCODE_WORKSPACE" --scheme "$XCODE_SCHEME"
    artifacts:
      - build/ios/ipa/*.aab
    publishing:
      app_story_connect:
        apple_id: ookiisoftware@gmail.com
        password: Encrypted(Z0FBQUFBQmdRVE9UWGt3LWVDV3FxbTJ6UjZxMnNSWnV6NFdjY3RsbHFKMDRVWjloejRaNEg4NVVQSWVQcmdKODlPZmNCVTVUa1ZEaGZOYlZtR1dBajlzd25KQWllOTNsNDZ1ZmlUN05JaTAzN2o2SVNIb3pGa0k9)
      email:
        recipients:
          - ookiisoftware@gmail.com